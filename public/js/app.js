function addEventListeners(){let e=document.querySelectorAll("article.card li.item input[type=checkbox]");[].forEach.call(e,function(e){e.addEventListener("change",sendItemUpdateRequest)});let t=document.querySelectorAll("article.card form.new_item");[].forEach.call(t,function(e){e.addEventListener("submit",sendCreateItemRequest)});let n=document.querySelectorAll("article.card li a.delete");[].forEach.call(n,function(e){e.addEventListener("click",sendDeleteItemRequest)});let d=document.querySelectorAll("article.card header a.delete");[].forEach.call(d,function(e){e.addEventListener("click",sendDeleteCardRequest)});let r=document.querySelector("article.card form.new_card");null!=r&&r.addEventListener("submit",sendCreateCardRequest)}function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function sendAjaxRequest(e,t,n,d){let r=new XMLHttpRequest;r.open(e,t,!0),r.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').content),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.addEventListener("load",d),r.send(encodeForAjax(n))}function sendItemUpdateRequest(){let e=this.closest("li.item");sendAjaxRequest("post","/api/item/"+e.getAttribute("data-id"),{done:e.querySelector("input[type=checkbox]").checked},itemUpdatedHandler)}function sendDeleteItemRequest(){sendAjaxRequest("delete","/api/item/"+this.closest("li.item").getAttribute("data-id"),null,itemDeletedHandler)}function sendCreateItemRequest(e){let t=this.closest("article").getAttribute("data-id"),n=this.querySelector("input[name=description]").value;""!=n&&sendAjaxRequest("put","/api/cards/"+t,{description:n},itemAddedHandler),e.preventDefault()}function sendDeleteCardRequest(e){sendAjaxRequest("delete","/api/cards/"+this.closest("article").getAttribute("data-id"),null,cardDeletedHandler)}function sendCreateCardRequest(e){let t=this.querySelector("input[name=name]").value;""!=t&&sendAjaxRequest("put","/api/cards/",{name:t},cardAddedHandler),e.preventDefault()}function itemUpdatedHandler(){let e=JSON.parse(this.responseText),t=document.querySelector('li.item[data-id="'+e.id+'"]');t.querySelector("input[type=checkbox]");t.checked="true"==e.done}function itemAddedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText),t=createItem(e),n=document.querySelector('article.card[data-id="'+e.card_id+'"]').querySelector("form.new_item");n.previousElementSibling.append(t),n.querySelector("[type=text]").value=""}function itemDeletedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText);document.querySelector('li.item[data-id="'+e.id+'"]').remove()}function cardDeletedHandler(){200!=this.status&&(window.location="/");let e=JSON.parse(this.responseText);document.querySelector('article.card[data-id="'+e.id+'"]').remove()}function cardAddedHandler(){200!=this.status&&(window.location="/");let e=createCard(JSON.parse(this.responseText)),t=document.querySelector("article.card form.new_card");t.querySelector("[type=text]").value="";let n=t.parentElement;n.parentElement.insertBefore(e,n),e.querySelector("[type=text]").focus()}function createCard(e){let t=document.createElement("article");return t.classList.add("card"),t.setAttribute("data-id",e.id),t.innerHTML=`\n\n  <header>\n    <h2><a href="cards/${e.id}">${e.name}</a></h2>\n    <a href="#" class="delete">&#10761;</a>\n  </header>\n  <ul></ul>\n  <form class="new_item">\n    <input name="description" type="text">\n  </form>`,t.querySelector("form.new_item").addEventListener("submit",sendCreateItemRequest),t.querySelector("header a.delete").addEventListener("click",sendDeleteCardRequest),t}function createItem(e){let t=document.createElement("li");return t.classList.add("item"),t.setAttribute("data-id",e.id),t.innerHTML=`\n  <label>\n    <input type="checkbox"> <span>${e.description}</span><a href="#" class="delete">&#10761;</a>\n  </label>\n  `,t.querySelector("input").addEventListener("change",sendItemUpdateRequest),t.querySelector("a.delete").addEventListener("click",sendDeleteItemRequest),t}addEventListeners();